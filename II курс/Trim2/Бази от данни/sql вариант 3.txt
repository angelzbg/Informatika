CREATE DATABASE VARIANT3; USE VARIANT3;

CREATE TABLE FLIGHTS(
FLIGHT_ID INT PRIMARY KEY,
DEPT DATETIME NOT NULL,
PLANE_TYPE CHAR(1) NOT NULL
);

CREATE TABLE PASSENGERS(
PASS_ID INT PRIMARY KEY,
PASS_NAME VARCHAR(64) NOT NULL
);

CREATE TABLE RESERVATIONS(
FLIGHT_ID INT FOREIGN KEY REFERENCES FLIGHTS ON DELETE CASCADE,
PASS_ID INT FOREIGN KEY REFERENCES PASSENGERS,
DATE DATETIME NOT NULL,
SEAT INT NOT NULL,
PRIMARY KEY(FLIGHT_ID, PASS_ID)
);

ALTER TABLE PASSENGERS ADD NAT VARCHAR(32); SELECT * FROM PASSENGERS;

SELECT * FROM FLIGHTS;
INSERT INTO FLIGHTS VALUES (1, GETDATE(), 'A'); SELECT * FROM FLIGHTS;

SELECT * FROM PASSENGERS;
INSERT INTO PASSENGERS VALUES(1, 'Nqkoi si', 'Bulgaria'); SELECT * FROM PASSENGERS;

SELECT * FROM RESERVATIONS;
INSERT INTO RESERVATIONS VALUES(1, 1, GETDATE(), 1); SELECT * FROM RESERVATIONS;



INSERT INTO PASSENGERS VALUES(6447, 'Nqkoi si', 'Bulgaria'); SELECT * FROM PASSENGERS;
INSERT INTO FLIGHTS VALUES(1876, GETDATE(), 'B'); SELECT * FROM FLIGHTS;
INSERT INTO RESERVATIONS VALUES(1876, 6447, GETDATE(), 5); SELECT * FROM RESERVATIONS;

UPDATE RESERVATIONS SET SEAT = 21 WHERE FLIGHT_ID = 1876 AND PASS_ID = 6447; SELECT * FROM RESERVATIONS;

DELETE FROM RESERVATIONS WHERE DATE > '10.11.2010'; SELECT * FROM RESERVATIONS;




USE PCTRADE;

SELECT JOB_TITLE, MIN_SALARY FROM JOBS WHERE MIN_SALARY>15000 ORDER BY MIN_SALARY ASC, JOB_TITLE DESC;

SELECT FNAME, LNAME, JOB_TITLE FROM EMPLOYEES E JOIN JOBS J ON E.JOB_ID = J.JOB_ID;

SELECT O.ORDER_ID, O.ORDER_DATE, COUNT(OI.PRODUCT_ID) AS COUNT FROM ORDERS O JOIN ORDER_ITEMS OI ON O.ORDER_ID = OI.ORDER_ID GROUP BY O.ORDER_ID, O.ORDER_DATE HAVING COUNT(OI.PRODUCT_ID) > 7;
--ÈËÈ:     ÀÌÀ ÌÀÉ ÑÒÀÂÀ ÂÚÏÐÎÑ ÇÀ ÏÚÐÂÎÒÎ
--SELECT O.ORDER_ID, O.ORDER_DATE, SUM(OI.QUANTITY) AS COUNT FROM ORDERS O JOIN ORDER_ITEMS OI ON O.ORDER_ID = OI.ORDER_ID GROUP BY O.ORDER_ID, O.ORDER_DATE HAVING COUNT(OI.QUANTITY) > 7;

CREATE VIEW NQKAKUVVIEW AS
SELECT CO.NAME, CU.FNAME, CU.LNAME FROM COUNTRIES CO LEFT JOIN CUSTOMERS CU ON CO.COUNTRY_ID = CU.COUNTRY_ID
GROUP BY CO.NAME, CU.FNAME, CU.LNAME;

SELECT * FROM NQKAKUVVIEW;