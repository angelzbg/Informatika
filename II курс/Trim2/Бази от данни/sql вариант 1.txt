CREATE DATABASE VARIANT1;
USE VARIANT1;

CREATE TABLE SELLERS(
EIK CHAR(10) PRIMARY KEY,
NAME VARCHAR(50) NOT NULL
);

CREATE TABLE PRODUCTS(
PROD_ID INT PRIMARY KEY,
NAME VARCHAR(100) NOT NULL,
UNIT_PRICE DECIMAL(7, 2)
);

--DROP TABLE SELLER_PRODUCTS;
CREATE TABLE SELLER_PRODUCTS(
EIK CHAR(10) FOREIGN KEY REFERENCES SELLERS ON DELETE CASCADE,
PROD_ID INT FOREIGN KEY REFERENCES PRODUCTS,
SOLD_NUMBER DECIMAL NOT NULL,
TIMESTAMP DATETIME NOT NULL DEFAULT FORMAT(GETDATE(), 'HH:mm:ss, dd.MM.yyyy'),
PRIMARY KEY(EIK, PROD_ID)
);

ALTER TABLE PRODUCTS ADD DATE DATE NOT NULL; SELECT * FROM PRODUCTS;

INSERT INTO SELLERS VALUES(123456789, 'Pesho'); SELECT * FROM SELLERS;

INSERT INTO PRODUCTS VALUES(1, 'Ime na product', 50.5, GETDATE()); SELECT * FROM PRODUCTS;

INSERT INTO SELLER_PRODUCTS VALUES(123456789, 1, 50, DEFAULT); SELECT * FROM SELLER_PRODUCTS;

INSERT INTO PRODUCTS VALUES(5, 'Ime na product', 50.5, GETDATE()); SELECT * FROM PRODUCTS;

UPDATE PRODUCTS SET NAME = 'Bordeaux', UNIT_PRICE = 24.75 WHERE PROD_ID = 5; SELECT * FROM PRODUCTS;

INSERT INTO PRODUCTS VALUES(2, 'Peneshto si', 50.5, GETDATE()); SELECT * FROM PRODUCTS;

DELETE FROM PRODUCTS WHERE NAME LIKE 'Pe%' AND UNIT_PRICE >= 50; SELECT * FROM PRODUCTS;



USE PCTRADE;

SELECT NAME FROM DEPARTMENTS WHERE CITY LIKE 'Seattle' ORDER BY NAME DESC;

SELECT NAME, LNAME FROM DEPARTMENTS D LEFT JOIN EMPLOYEES E ON D.MANAGER_ID = E.EMPLOYEE_ID;

SELECT P.NAME, COUNT(OI.PRODUCT_ID) AS 'Брой поръчки, в които е участвал'FROM PRODUCTS P JOIN ORDER_ITEMS OI ON P.PRODUCT_ID= OI.PRODUCT_ID GROUP BY P.NAME HAVING COUNT(OI.PRODUCT_ID) > 2;

CREATE VIEW NESHTOSI
AS
SELECT C.FNAME, C.LNAME, COUNT(O.ORDER_ID) AS 'Брой поръчки' FROM CUSTOMERS C
LEFT JOIN ORDERS O ON C.CUSTOMER_ID = O.CUSTOMER_ID
GROUP BY C.CUSTOMER_ID, C.FNAME, C.LNAME;

SELECT * FROM NESHTOSI;